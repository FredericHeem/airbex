// JSON parser
this.JSON||(this.JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)r=rep[n],typeof r=="string"&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),typeof window.Intercom!="function"&&(window.Intercom=function(){window.Intercom.c(arguments)},window.Intercom.q=[],window.Intercom.c=function(e){window.Intercom.q.push(e)}),window.Intercom._classes={},window.Intercom.Util={},window.Intercom.Module={},window.Intercom.default_options={fake_message_response:null},Intercom.Util.is_defined=function(e){return typeof e!="undefined"},Intercom.Util.is_non_null=function(e){return Intercom.Util.is_defined(e)&&e!==null},Intercom.Util.index_of_in_array=function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},Intercom.Util.duplicate_object=function(e){var t=e instanceof Array?[]:{};for(var n in e){if(n=="clone")continue;e[n]&&typeof e[n]=="object"?t[n]=Intercom.Util.duplicate_object(e[n]):t[n]=e[n]}return t},Intercom.Util.default_ajax_options={type:"POST",data:"",jsonp_suffix:"",success:function(){},error:function(){}},Intercom.Util.is_empty=function(e){for(var t in e)return!1;return!0},Intercom.Util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&typeof e[n]=="undefined"?e[n]=t[n]:typeof t[n]=="object"&&typeof e[n]=="object"&&Intercom.Util.extend(e[n],t[n]);return e},Intercom.Util.ISO8601_to_date=function(e){return new Date((e||"").replace(/-/g,"/").replace(/[TZ]/g," "))},Intercom.Util.ajax_call=function(e){e=Intercom.Util.extend(Intercom.Util.duplicate_object(e),Intercom.Util.default_ajax_options);if(typeof e.url=="undefined")return;var t="XHR";typeof e.request_method!="undefined"?t=e.request_method:typeof XMLHttpRequest!="undefined"&&("withCredentials"in new XMLHttpRequest||typeof XDomainRequest!="undefined")?typeof XDomainRequest!="undefined"&&(t="XDR"):t="JSONP";if(t=="JSONP"){var n="IntercomJSONP"+(new Date).getTime();window[n]=function(t){typeof t=="string"&&(t=JSON.parse(t)),e.success(t)};var r=document.createElement("SCRIPT");r.id=n,r.setAttribute("charset","utf-8"),r.setAttribute("type","text/javascript"),r.setAttribute("src",e.url+e.jsonp_suffix+"?"+e.data+"&callback="+n+"&_="+(new Date).getTime()),document.body.appendChild(r)}else{var i;if(t=="XDR"){i=new XDomainRequest;try{i.open(e.type,e.url)}catch(s){Intercom.Util.ajax_call(Intercom.Util.extend({request_method:"JSONP"},e));return}i.ontimeout=function(){},i.onprogress=function(){},i.timeout=1e4}else i=new XMLHttpRequest,i.open(e.type,e.url,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded");var o=function(){var t=i.response||i.responseText;typeof t=="string"&&(t=JSON.parse(t)),e.success(t)},u=function(){var t=i.response||i.responseText;if(typeof t=="string")try{t=JSON.parse(t)}catch(n){}if(i.status==403)if(typeof t=="object"&&typeof t.error_message=="string"&&t.error_message=="app suspended")Intercom.Util.log("This app's Intercom account is suspended");else{var r="You have enabled secure mode in your app and ";typeof window.intercomSettings!="undefined"?typeof window.intercomSettings.user_hash=="undefined"?r+="your intercomSettings are missing the user_hash property.":r+="your user_hash property is not what we expect for this user.":r+=" Intercom cannot authenticate this user.",Intercom.Util.log(r)}else Intercom.Util.ajax_call(Intercom.Util.extend({request_method:"JSONP"},e))};t=="XDR"?(i.onload=o,i.onerror=u):i.onreadystatechange=function(){i.readyState==4&&(i.status>=200&&i.status<=206?o(i):u(i))},i.send(e.data.length>0?e.data:null)}},Intercom.Util.get_ie_version_func=function(){var e,t=3,n=document.createElement("div"),r=n.getElementsByTagName("i");while(n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",r[0]);return t>4?t:e},function(e){typeof e=="undefined"&&(e={}),e.add_CSS=function(e,t){if(e.length==0)return;var n=document.createElement("style");n.type="text/css",n.media="all",n.className=t,n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(n)},e.HEX_to_HSL=function(e){e=e.toUpperCase();var t=parseInt(e.substr(1,2),16)/255,n=parseInt(e.substr(3,2),16)/255,r=parseInt(e.substr(5,2),16)/255,i=Math.max(t,n,r),s=Math.min(t,n,r),o,u,a=(i+s)/2;if(i==s)o=u=0;else{var f=i-s;u=a>.5?f/(2-i-s):f/(i+s);switch(i){case t:o=(n-r)/f+(n<r?6:0);break;case n:o=(r-t)/f+2;break;case r:o=(t-n)/f+4}o/=6}return[o,u,a]},e.HSL_to_HEX=function(t,n,r){var i,s,o;t=Math.min(t,360),n=Math.min(n,1),r=Math.min(r,1),t==360&&(t=0),t=Math.max(t,0),n=Math.max(n,0),r=Math.max(r,0);if(n==0)i=s=o=r;else{function u(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var a=r<.5?r*(1+n):r+n-r*n,f=2*r-a;i=u(f,a,t+1/3),s=u(f,a,t),o=u(f,a,t-1/3)}var l=e.zero_pad_string(Math.round(i*255).toString(16),2),c=e.zero_pad_string(Math.round(s*255).toString(16),2),h=e.zero_pad_string(Math.round(o*255).toString(16),2);return"#"+l+c+h},e.zero_pad_string=function(e,t){while(e.length<t)e="0"+e;return e}}(Intercom.Util),typeof window.log=="undefined"?Intercom.Util.log=function(){Intercom.Util.log.history=Intercom.Util.log.history||[],Intercom.Util.log.history.push(arguments),arguments.callee=arguments.callee.caller,window.console&&console.log(Array.prototype.slice.call(arguments))}:Intercom.Util.log=window.log,Intercom.Store=function(e){function r(){return typeof n.ie_version=="number"&&n.ie_version in[6,7,8]}function i(){return n.options.inert&&typeof n.options.fake_message_response!="undefined"}function s(e){return typeof e=="string"?JSON.parse(e):e}var t=["_store","inbox","cache_version"],n=this;return n._store={},n.inbox=[],n.event_queue=[],n.event_handlers=[],n.options=Intercom.Util.extend(typeof e=="object"?e:{},Intercom.Store.default_options),n.pending_readmarks=[],n.localStorage_key="intercomStore-"+n.options.user_data.app_id+"-"+encodeURIComponent(n.options.user_data.user_id===undefined?n.options.user_data.email:n.options.user_data.user_id),n.cache_version=8,n.unread_count=0,n.inbox_unread_count=0,n.store_message_id=undefined,n.still_to_call_backreference=!0,n.ie_version=Intercom.Util.get_ie_version_func(),n.init=function(){if(typeof n.ie_version!="number"&&n.options.log_options_validation){if(!n.options.user_data.app_id)return Intercom.Util.log("intercomSettings must have an app_id attribute"),!1;n.options.user_data.created_at==1234567890&&Intercom.Util.log("Don't forget to set intercomSettings.created_at attribute to be your user's sign up date "),n.options.user_data.email=="john.doe@example.com"&&Intercom.Util.log("Don't forget to set intercomSettings.email attribute to be your user's email ")}return n.trash_other_caches(),i()?n.receive_message_threads(n.options.fake_message_response):n.is_cached()?(n.load_store_from_cache(),n.process_cached_store(),n.update_message_threads()):n.load_message_threads(),n},n.shutdown=function(){localStorage.removeItem(n.localStorage_key)},n.trash_other_caches=function(){if(!n.localStorage_supported())return;var e=[],t;for(var r=0,i=localStorage.length;r<i;r++)t=localStorage.key(r),t!==undefined&&t.match(/^intercomStore/)&&t!==n.localStorage_key&&e.push(t);for(var r=0,i=e.length;r<i;r++)localStorage.removeItem(e[r])},n.load_store_from_cache=function(){if(n.is_cached()){var e=JSON.parse(localStorage.getItem(n.localStorage_key));for(var r=0,i=t.length;r<i;r++)n[t[r]]=e[t[r]],t[r]==="_store"?(n.workaround_prototype_insanity(n._store),n.restore_date_format_where_appropriate(n._store)):t[r]==="inbox"&&typeof n.inbox=="string"&&(n.inbox=s(n.inbox));n.still_to_call_backreference&&n.call_backreference()}},n.restore_date_format_where_appropriate=function(e){for(var t in e)t!=="created_at_date"&&t!=="updated_at_date"||typeof e[t]!="string"?typeof e[t]=="object"&&n.restore_date_format_where_appropriate(e[t]):e[t]=new Date(e[t])},n.workaround_prototype_insanity=function(e){if(typeof e.message_threads=="string"){e.message_threads=s(e.message_threads);for(var t=0,n=e.message_threads.length;t<n;t++){var r=e.message_threads[t];r.attachments=s(r.attachments),r.messages=s(r.messages);if(typeof r.message_threads!="undefined"){r.message_threads=s(r.message_threads);for(var i=0,o=r.message_threads.l;i<o;i++){var u=r.message_threads[i];u.attachments=s(u.attachments),u.comments=s(u.comments)}}}}},n.process_cached_store=function(){n.throw_event("START_PROCESSING_MESSAGES");var e=n.get_message_threads(),t;for(var r=0,i=e.length;r<i;r++)t=e[r],t.read||n.update_counts_and_events_for_new_unread_message(t.id),n.throw_event("RECEIVE_NEW_MESSAGE",{message:t}),!t.read&&t.interrupt&&(!n.message_thread_has_comments(t)||n.created_by_admin(n.get_last_message_thread_comment(t)))&&n.throw_event("INTERRUPT",{message_id:t.id});n.throw_event("STORE_LOADED")},n.call_backreference=function(){n.options.onProcessData({base:n,timestamp:(new Date).getTime()},n),n.throw_event("PROCESSED_DATA"),n.still_to_call_backreference=!1},n.save_store_to_cache=function(){if(n.localStorage_supported()){var e={};for(var r=0,i=t.length;r<i;r++)e[t[r]]=n[t[r]];localStorage.setItem(n.localStorage_key,JSON.stringify(e))}},n.is_cached=function(){if(n.localStorage_supported()&&localStorage.getItem(n.localStorage_key))return JSON.parse(localStorage.getItem(n.localStorage_key)).cache_version===n.cache_version?!0:(localStorage.removeItem(n.localStorage_key),!1)},n.localStorage_supported=function(){try{return"localStorage"in window&&window.localStorage!==null?(localStorage.setItem("intercomStore-storage-test","test"),localStorage.removeItem("intercomStore-storage-test"),!0):!1}catch(e){return!1}},n.get_detected_ie_version=function(){return n.ie_version},n.request_message_threads=function(e){if(typeof n.options.inert=="boolean"&&n.options.inert)return;var t=n.options.message_index_url,i={referer:location.href,inbox_installed:n.options.inbox_installed,require_utf8_enforcement:r(),app_id:n.options.user_data.app_id,user_data:n.options.user_data};i=Intercom.Store.Util.format_data_for_request(i),Intercom.Util.ajax_call({type:"POST",url:t,data:i,success:e})},n.load_message_threads=function(){n.request_message_threads(n.receive_message_threads)},n.update_message_threads=function(){n.request_message_threads(n.parse_new_message_threads)},n.update_user_data=function(e){if(e===undefined)return;n.options.user_data=Intercom.Util.extend(e,n.options.user_data)},n.add_helper_attributes=function(e){if(typeof e.text=="undefined"&&typeof e.rendered_body=="string"){var t=document.createElement("SPAN"),r=e.rendered_body;t.innerHTML=r.replace(/\<img[^\>]*\>/gi,"").replace(/\<iframe[^\>]*\>/gi,"").replace(/src\=\"[^\"]*\"/gi,"").replace(/src\=\'[^\"]*\'/gi,""),e.text=t.innerText||t.textContent,t=null}if(typeof e.title=="undefined"&&typeof e.text=="string"){var i;typeof e.subject=="string"&&e.subject.length>0?i=e.subject:i=e.text;var s=i.substring(0,36);s!=i&&(s+="..."),e.title=s}e.has_avatar=Intercom.Util.is_defined(e.owner)&&Intercom.Util.is_non_null(e.owner.avatar.square_25)&&Intercom.Util.is_non_null(e.owner.avatar.square_50),(typeof e.updated_at_date=="undefined"||typeof e.updated_at_date=="string")&&typeof e.updated_at=="string"&&(e.updated_at_date=Intercom.Util.ISO8601_to_date(e.updated_at)),(typeof e.created_at_date=="undefined"||typeof e.created_at_date=="string")&&typeof e.created_at=="string"&&(e.created_at_date=Intercom.Util.ISO8601_to_date(e.created_at));if(n.message_thread_has_comments(e)){var o=n.get_message_thread_comments(e);for(var u=0,a=o.length;u<a;u++)n.add_helper_attributes(o[u])}return e},n.receive_message_threads=function(e){if(typeof intercom_obj=="undefined")return;var t=Intercom.Util.duplicate_object(e.messages);delete e.messages,n._store=e,n._store.message_threads=[],typeof n._store.app=="undefined"&&(n._store.app={}),n._store.app.id=n.options.user_data.app_id,n.throw_event("START_PROCESSING_MESSAGES");for(var r=0,i=t.length;r<i;r++)n.add_message_thread({message:t[r]},{quiet:!0});n.save_store_to_cache(),n.still_to_call_backreference&&n.call_backreference(),n.throw_event("STORE_LOADED")},n.parse_new_message_threads=function(e){if(typeof intercom_obj=="undefined")return;n.update_cached_config(e);var t=e.messages;for(var r=0,i=t.length;r<i;r++){var s=t[r];if(n.message_thread_exists(s)){if(n.message_thread_has_comments(s)){var o=n.get_message_thread_comments(s);for(var u=0,a=o.length;u<a;u++){var f=Intercom.Util.duplicate_object(o[u]);f.message_id=s.id,n.comment_exists(f)||n.add_response({comment:f})}}}else n.add_message_thread({message:s})}},n.update_cached_config=function(e){var t=Intercom.Util.duplicate_object(e);delete t.messages,n._store=Intercom.Util.extend(t,n._store),n.save_store_to_cache()},n.get_app_settings=function(){return typeof n._store.app!="object"?undefined:n._store.app},n.get_module_settings=function(){return typeof n._store.modules!="object"?undefined:n._store.modules},n.get_user_settings=function(){return typeof n._store.user!="object"?undefined:n._store.user},n.are_all_message_threads_read=function(e){return e=Intercom.Util.extend(typeof e=="object"?e:{},{look_in:"message_threads"}),e.look_in=="inbox"?n.inbox_unread_count==0:n.unread_count==0},n.get_last_unread=function(e){return e=Intercom.Util.extend(typeof e=="object"?e:{},{look_in:"message_threads"}),n.get_message_thread(n.get_last_unread_id(e))},n.get_last_unread_id=function(e){e=Intercom.Util.extend(typeof e=="object"?e:{},{look_in:"message_threads"});var t;e.look_in=="inbox"?t=n.get_inbox_message_threads():t=n.get_message_threads();if(n.get_unread_count(e)==0)return undefined;for(var r=t.length-1;r>=0;r--)if(!t[r].read&&Intercom.Util.index_of_in_array(n.pending_readmarks,t[r].id)==-1&&(e.message_type===undefined||t[r].message_type===e.message_type)&&(e.interrupt===undefined||t[r].interrupt===e.interrupt))return t[r].id},n.get_message_thread_count=function(){return typeof n._store.message_threads!="object"?0:n._store.message_threads.length},n.get_inbox_size=function(){return n.inbox.length},n.get_unread_count=function(e){return e=Intercom.Util.extend(typeof e=="object"?e:{},{look_in:"message_threads"}),e.look_in=="inbox"?n.inbox_unread_count:n.unread_count},n.get_message_thread=function(e){return typeof n._store.message_threads!="object"?undefined:n._store.message_threads[n.get_message_thread_index(e)]},n.message_thread_exists=function(e){return typeof n.get_message_thread_index(e.id)!="undefined"},n.comment_exists=function(e){return n.legacy_comment_exists(e)},n.message_thread_has_comments=function(e){return n.legacy_message_thread_has_comments(e)},n.get_message_thread_comments=function(e){return n.legacy_get_message_comments(e)},n.legacy_comment_exists=function(e){var t;if(e.message_id!==undefined&&n.message_thread_exists({id:e.message_id})&&(t=n.get_message_thread(e.message_id))&&n.message_thread_has_comments(t)){var r=n.legacy_get_message_comments(t);for(var i=r.length-1;i>=0;i--)if(r[i].id==e.id)return!0}return!1},n.legacy_message_thread_has_comments=function(e){return typeof e=="object"&&typeof e.message_threads=="object"&&typeof e.message_threads[0]=="object"&&typeof e.message_threads[0].comments=="object"},n.legacy_get_message_comments=function(e){return n.legacy_message_thread_has_comments(e)?e.message_threads[0].comments:[]},n.get_last_message_thread_comment=function(e){var t=n.get_message_thread_comments(e);if(t.length!==0)return t[t.length-1]},n.get_message_threads=function(){return typeof n._store.message_threads!="object"?[]:n._store.message_threads},n.get_inbox_message_threads=function(){var e=[];for(var t=0,r=n.inbox.length;t<r;t++){var i=n.get_message_thread(n.inbox[t]);i!==undefined&&e.push(i)}return e},n.get_message_thread_index=function(e){if(typeof n._store.message_threads!="object")return undefined;for(var t=0;t<n._store.message_threads.length;t++)if(n._store.message_threads[t].id==e)return t},n.check_for_all_read=function(e){n.unread_count<=0&&(n.unread_count=0,n.throw_event("ALL_READ")),e&&n.inbox_unread_count<=0&&(n.inbox_unread_count=0,n.throw_event("ALL_INBOX_READ"))},n.mark_message_as_read=function(e){if(typeof n.options.inert=="boolean"&&n.options.inert)return;if(typeof e=="undefined")return;var t=n.get_message_thread(e);if(typeof t!="undefined"&&!t.read&&!n.has_pending_readmark(e)){var r=n.options.read_marks_url,i=Intercom.Store.Util.format_data_for_request({message_id:e,user_data:{email:n.options.user_data.email,user_id:n.options.user_data.user_id,user_hash:n.options.user_data.user_hash}});n.pending_readmarks.push(e),n.mark_message_in_cache_as_read(e),Intercom.Util.ajax_call({type:"POST",url:r,data:i,jsonp_suffix:"/create",success:n.ajax_response_for_marking_message_as_read})}},n.ajax_response_for_marking_message_as_read=function(e){if(typeof intercom_obj=="undefined"||!intercom_obj.ready)return;var t=Intercom.Util.index_of_in_array(n.pending_readmarks,e.message_id);t!=-1&&n.pending_readmarks.splice(t,1)},n.has_pending_readmark=function(e){return Intercom.Util.index_of_in_array(n.pending_readmarks,e)!=-1},n.mark_message_in_cache_as_read=function(e){var t=n.get_message_thread(e);if(t==undefined)return;t.read=!0,n.save_store_to_cache(),n.throw_event("MESSAGE_MARKED_AS_READ",{message_id:e});var r=n.is_inbox_message(t.id),i=n.message_thread_exists_in_inbox(t.id);r&&!i&&n.inbox.push(t.id),n.unread_count-=1,n.throw_event("READ_COUNT_CHANGED"),i&&(n.inbox_unread_count-=1,n.throw_event("INBOX_READ_COUNT_CHANGED")),n.check_for_all_read(i)},n.send_user_response=function(e,t){if(typeof n.options.inert=="boolean"&&n.options.inert)return;if(typeof e!="number"||typeof t!="string"||t.length==0){n.throw_event("USER_RESPONSE_VALIDATION_FAILURE");return}if(n.store_message_id!=undefined){n.throw_event("MAJOR_STORE_FAULT");return}n.throw_event("START_SENDING_USER_RESPONSE");var i=Intercom.Store.Util.format_data_for_request({referer:location.href,request_type:"comment",message_id:e,body:t,app_id:n.options.user_data.app_id,user_data:{email:n.options.user_data.email,user_id:n.options.user_data.user_id,user_hash:n.options.user_data.user_hash},require_utf8_enforcement:r()});n.store_message_id=e,Intercom.Util.ajax_call({type:"POST",url:n.options.comments_url,data:i,jsonp_suffix:"/create",success:function(e){if(typeof intercom_obj=="undefined"||!intercom_obj.ready)return;n.add_user_response(e),n.throw_event("GOT_USER_RESPONSE_SUCCESS",{comment:e.comment})}})},n.add_response=function(e){n.store_message_id==undefined&&(n.store_message_id=e.comment.message_id);var t=n.store_message_id,r=n.get_message_thread(t),i=r.message_threads;typeof i=="undefined"&&(r.message_threads=[{comments:[],message_id:t}]);if(n.comment_exists(e.comment))return;n.add_helper_attributes(e.comment),r.message_threads[0].comments.push(e.comment),r.updated_at=e.comment.updated_at,r.updated_at_date=e.comment.updated_at_date,n.save_store_to_cache(),n.throw_event("RECEIVE_NEW_COMMENT",e),!e.comment.created_by_user&&r.read&&(r.read=!1,n.update_counts_and_events_for_new_unread_message(t),r.interrupt&&n.throw_event("INTERRUPT",{message_id:r.id})),n.store_message_id=undefined},n.add_user_response=function(e){return n.add_response(e)},n.update_counts_and_events_for_new_unread_message=function(e){n.unread_count+=1,n.throw_event("NEW_UNREAD"),n.throw_event("UNREAD"),n.throw_event("READ_COUNT_CHANGED"),n.message_thread_exists_in_inbox(e)&&(n.inbox_unread_count+=1,n.throw_event("NEW_INBOX_UNREAD"),n.throw_event("INBOX_UNREAD"),n.throw_event("INBOX_READ_COUNT_CHANGED"))},n.send_new_message=function(e){if(typeof n.options.inert=="boolean"&&n.options.inert)return;if(typeof e!="string"||e.length==0){n.throw_event("NEW_MESSAGE_VALIDATION_FAILURE");return}n.throw_event("START_SENDING_NEW_MESSAGE");var t=Intercom.Store.Util.format_data_for_request({referer:location.href,request_type:"message",body:e,app_id:n.options.user_data.app_id,user_data:{email:n.options.user_data.email,user_id:n.options.user_data.user_id,user_hash:n.options.user_data.user_hash},require_utf8_enforcement:r()});Intercom.Util.ajax_call({type:"POST",url:n.options.new_message_url,data:t,jsonp_suffix:"/create",success:function(e){if(typeof intercom_obj=="undefined"||!intercom_obj.ready)return;n.add_user_message_thread(e),n.throw_event("GET_NEW_MESSAGE_SUCCESS",{message:e.message})}})},n.add_message_thread=function(e,t){n.message_thread_exists(e.message)||(n._store.message_threads.unshift(n.add_helper_attributes(e.message)),n.is_inbox_message(e.message.id)&&n.inbox.push(e.message.id),e.message.read||n.update_counts_and_events_for_new_unread_message(e.message.id),n.save_store_to_cache(),n.throw_event("RECEIVE_NEW_MESSAGE",e),!e.message.read&&e.message.interrupt&&(!n.message_thread_has_comments(e.message)||n.created_by_admin(n.get_last_message_thread_comment(e.message)))&&n.throw_event("INTERRUPT",{message_id:e.message.id}))},n.add_user_message_thread=function(e){n.add_message_thread(e)},n.throw_event=function(e,t){if(typeof intercom_obj=="undefined")return;var r={timestamp:(new Date).getTime(),type:e,data:t};n.event_queue.push(r);for(var i=0,s=n.event_handlers.length;i<s;i++)n.event_handlers[i](e,t)},n.register_event_handler=function(e,t){if(typeof t!="undefined")for(var r=0,i=n.event_queue.length;r<i;r++)t<=n.event_queue[r].timestamp&&e(n.event_queue[r].type,n.event_queue[r].data);n.event_handlers.push(e)},n.register_specific_event_handler=function(e,t,r){n.register_event_handler(function(n,r){e===n&&t(n,r)},r)},n.is_inbox_message=function(e){var t=n.get_message_thread(e);if(t===undefined)return!1;var r=t.message_type===undefined?t.interrupt?"conversation":"inbox":t.message_type;return r=="inbox"||r=="email"||r=="conversation"||r=="announcement"||r=="notification"&&t.read||n.message_thread_has_comments(t)},n.message_thread_exists_in_inbox=function(e){var t=Intercom.Util.index_of_in_array(n.inbox,e);return t!=-1},n.created_by_user=function(e){return!n.created_by_admin(e)},n.created_by_admin=function(e){return e!==undefined&&e.from!==undefined&&typeof e.from.is_admin=="boolean"&&e.from.is_admin},n},Intercom.Store.Util={format_data_for_request:function(e){var t=[];for(var n in e){if(typeof e[n]=="undefined"||e[n]===null)continue;var r=null;switch(n){case"require_utf8_enforcement":n="utf8",r="âœ“";break;case"request_type":break;default:r=e[n];if(typeof r=="object"||typeof r=="array")r=JSON.stringify(r);r=encodeURIComponent(r)}if(r===null)continue;var i=n+"="+r;t.push(i)}return stringified=t.join("&"),stringified}},function(){var e="https://api.intercom.io";document.getElementById("IntercomApiEndpointOverride")&&(e=document.getElementById("IntercomApiEndpointOverride").getAttribute("content")),Intercom.api_endpoint=function(){return e},Intercom.Store.default_options={comments_url:Intercom.api_endpoint()+"/api/comments",new_message_url:Intercom.api_endpoint()+"/api/messages",message_index_url:Intercom.api_endpoint()+"/api/messages/index",read_marks_url:Intercom.api_endpoint()+"/api/read_marks",api_endpoint:Intercom.api_endpoint(),default_app_name:"support",inert:!1,log_options_validation:!0,onProcessData:function(e){}}}(),Intercom.Boot=function(e){function n(e){t.user_data=Intercom.Util.duplicate_object(e),delete t.user_data.modules,delete t.user_data.widget,delete t.user_data.inert,delete t.user_data.fake_message_response}function r(e){return typeof e.widget=="string"?e.widget={activator:e.widget,use_activator:!0}:Intercom.Util.is_non_null(e.widget)?e.widget=Intercom.Util.extend({activator:Intercom.Util.is_defined(e.widget.activator)?e.widget.activator:"body>html>body",use_activator:!0},e.widget):e.widget={activator:"body",use_activator:!1},e}function i(e){if(typeof e.modules!="undefined"||typeof e.widget!="object")return;e.modules={},e.modules.messages=Intercom.Util.duplicate_object(e.widget)}function s(e){if(document.querySelectorAll&&typeof e.modules=="object"&&typeof e.modules.messages=="object"&&typeof e.modules.messages.activator=="string"&&typeof e.modules.messages.use_activator=="boolean"&&e.modules.messages.use_activator){var n=document.querySelectorAll(e.modules.messages.activator);for(var r=0,i=n.length;r<i;r++)document.body.addEventListener?n[r].addEventListener("click",t.store_click,!0):n[r].attachEvent("onclick",t.store_click)}}function o(){var e=Intercom.Util.get_ie_version_func();return typeof e=="number"&&e==6}var t=this;return t.store={},t.store_ready_at=0,t.modules=[],t.ready=!1,t.on_ready=function(){},t.modules_to_install={},t.init=function(){return s(e),n(e),r(e),i(e),t.options=Intercom.Util.extend(e,Intercom.default_options),t},t.shutdown=function(){t.shutdown_modules(),typeof t.store.shutdown=="function"&&t.store.shutdown(),t.ready=!1,t.store=null},t.shutdown_modules=function(){while(t.modules.length>0){var e=t.modules.shift();typeof e.shutdown=="function"&&e.shutdown(),e=null}},t.store_click=function(e){return e=e||window.event,document.body.addEventListener?this.setAttribute("intercom_click","clicked"):e.srcElement.setAttribute("intercom_click","clicked"),e.preventDefault?e.preventDefault():e.returnValue=!1,!1},t.configure_which_modules_to_install=function(e){t.module_is_disabled("messages")||(t.modules_to_install.messages="https://d2nvy5xhcrv86v.cloudfront.net/assets/messages-f2a194a1b34ab5ea33619b31d71a4acf.js");if(!t.module_is_disabled("pusher")){var n=e.get_app_settings();typeof n=="object"&&typeof n.paid=="boolean"&&n.paid&&(t.modules_to_install.pusher="https://d2nvy5xhcrv86v.cloudfront.net/assets/pusher-da65a20b1b452e81208108ff0c0dca9f.js")}!t.module_is_disabled("dev")&&(location.hostname.match(/(dev\.intercom\.io|intercom\.dev)$/)||location.hostname.match(/intercom-experimental-web/))&&(t.modules_to_install.dev="https://d2nvy5xhcrv86v.cloudfront.net/assets/dev-948dcf7e36375603e85de7c4f54eb334.js")},t.module_is_disabled=function(e){if(o())return!0;if(e==="pusher"){var n=["7guo5kws","lyhlq848","sj6g9cio"];if(Intercom.Util.index_of_in_array(n,t.user_data.app_id)!==-1)return!0}if(typeof t.options.disable_modules=="object")for(var r=0,i=t.options.disable_modules.length;r<i;r++)if(t.options.disable_modules[r]==e)return!0;return!1},t.install_modules=function(){var e=[],n=[],r={};for(var i in window.Intercom.Module)n.push(i.toLowerCase()),r[i.toLowerCase()]=i;for(var s in t.modules_to_install)Intercom.Util.index_of_in_array(t.modules,s)==-1?e.push(t.modules_to_install[s]):t.register_module(new r[s](t.options.modules[s],t));for(var o=0,u=e.length;o<u;o++){var a=document.createElement("SCRIPT");a.setAttribute("type","text/javascript"),a.setAttribute("charset","utf-8"),a.setAttribute("src",e[o]),document.body.appendChild(a)}},t.register_module=function(e){if(typeof t.modules_to_install[e["name"]]=="undefined")return;delete t.modules_to_install[e.name],e.owner=t,t.modules.push(e);for(var n in t.modules_to_install)return;t.boot_modules()},t.boot_modules=function(){for(var e=0,n=t.modules.length;e<n;e++)t.modules[e].boot();t.mark_as_ready()},t.get_module=function(e){for(var n=0,r=t.modules.length;n<r;n++)if(t.modules[n].name==e)return t.modules[n]},t.store_ready=function(e,n){t.store_ready_at=e,t.merge_server_supplied_module_options(n),t.configure_which_modules_to_install(n);for(var r in t.modules_to_install){t.install_modules();return}t.mark_as_ready()},t.merge_server_supplied_module_options=function(e){var n=e.get_module_settings();if(typeof n=="undefined")return;typeof t.options.modules=="undefined"?t.options.modules=n:(Intercom.Util.extend(t.options.modules,n),typeof n.messages=="object"&&typeof n.messages.template_partials=="object"&&(t.options.modules.messages.template_partials=Intercom.Util.extend(Intercom.Util.duplicate_object(n.messages.template_partials),Intercom.Util.duplicate_object(t.options.modules.messages.template_partials))))},t.mark_as_ready=function(){t.ready=!0,t.on_ready()},t},function(){var e={};e.reattachActivator=function(){if(typeof intercom_obj=="undefined")return;var e=this.get_module("messages");typeof e=="object"&&e.reattach()},e.show=function(){if(typeof intercom_obj=="undefined")return;var e=this.get_module("messages");typeof e=="object"&&typeof intercomJQuery!="undefined"&&typeof intercomJQuery.cmodal=="function"&&intercomJQuery.cmodal.show(e.el)},e.hide=function(){typeof intercomJQuery!="undefined"&&typeof intercomJQuery.cmodal=="function"&&intercomJQuery.cmodal.hide()},e.update=function(e){typeof intercom_obj=="undefined"?window.Intercom.public_api.boot(e):(intercom_obj.store.update_user_data(e),intercom_obj.store.update_message_threads())},e.boot=function(e){typeof intercom_obj=="undefined"&&(window.intercom_obj=(new Intercom.Boot(e)).init(),window.intercom_obj.on_ready=window.Intercom.process_queued_calls,Intercom.init_store())},e.shutdown=function(){if(typeof intercom_obj=="undefined")return;intercom_obj.shutdown(),intercom_obj=undefined},e.onShow=function(e){typeof intercom_obj!="undefined"&&intercom_obj.store.register_specific_event_handler("MODAL_SHOWN",function(t,n){e(n)})},e.onHide=function(e){typeof intercom_obj!="undefined"&&intercom_obj.store.register_specific_event_handler("MODAL_HIDDEN",function(t,n){e(n)})},e.onActivatorClick=function(e){typeof intercom_obj!="undefined"&&intercom_obj.store.register_specific_event_handler("ACTIVATOR_CLICKED",function(t,n){e(n)})},e.reattach_activator=e.reattachActivator,window.Intercom.public_api=e}(),Intercom.init_store=function(){var e=intercom_obj.options,t=Intercom.Util.extend({user_data:intercom_obj.user_data,fake_message_response:e.fake_message_response,inert:e.inert,booter_backreference:intercom_obj,api_endpoint:Intercom.api_endpoint(),inbox_installed:typeof e.modules!="undefined"&&typeof e.modules.messages!="undefined"&&typeof e.modules.messages.activator!="undefined"&&e.modules.messages.activator!="body",onProcessData:function(e,t){e.base.options.booter_backreference.store_ready(e.timestamp,t)}},e.store_options);intercom_obj.store=new Intercom.Store(t),intercom_obj.store.init()},typeof intercomSettings!="undefined"&&(window.intercom_obj=(new Intercom.Boot(intercomSettings)).init(),Intercom.init_store()),window.Intercom.process_queued_calls=function(){window.Intercom.c=function(e){e=Array.prototype.slice.call(e);var t=e.shift
();if(typeof window.Intercom.public_api[t]=="function"){var n=typeof window.intercom_obj!="undefined"?window.intercom_obj:this;return window.Intercom.public_api[t].apply(n,e)}};var e;while(e=window.Intercom.q.shift())window.Intercom.c(e)},window.Intercom.look_for_boot_in_queued_calls=function(){var e=[],t,n;while(n=window.Intercom.q.shift()){var r=Array.prototype.slice.call(n),i=r.shift();i==="boot"?t=function(){window.Intercom.public_api.boot.apply(this,r)}:e.push(n)}window.Intercom.q=e,typeof t=="function"&&t()},typeof window.intercom_obj=="object"&&window.intercom_obj.ready?window.Intercom.process_queued_calls():typeof window.intercom_obj=="object"?window.intercom_obj.on_ready=window.Intercom.process_queued_calls:(window.Intercom.look_for_boot_in_queued_calls(),typeof window.intercom_obj!="object"&&(window.Intercom.c=function(e){var t=Array.prototype.slice.call(e),n=t.shift();n==="boot"?window.Intercom.public_api.boot.apply(this,t):window.Intercom.q.push(e)}));